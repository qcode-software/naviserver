
<!DOCTYPE html><html><head>
<title>ns_httpopen - NaviServer Built-in Commands</title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<!-- Generated from file 'ns_httpopen.man' by tcllib/doctools with format 'html'
   -->
<!-- ns_httpopen.n
   -->
<body><div id="man-header">
  <a href="http://wiki.tcl.tk/2090"><span class="logo">&nbsp;</span><strong>NaviServer</strong></a>
  - programmable web server
</div>
 <hr> [
   <a href="../../toc.html">Main Table Of Contents</a>
| <a href="../toc.html">Table Of Contents</a>
| <a href="../../index.html">Keyword Index</a>
 ] <hr>
<div class="doctools">
<h1 class="doctools_title">ns_httpopen(n) 4.99.19 naviserver &quot;NaviServer Built-in Commands&quot;</h1>
<div id="name" class="doctools_section"><h2><a name="name">Name</a></h2>
<p>ns_httpopen - Fetch a web page</p>
</div>
<div id="toc" class="doctools_section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="doctools_toc">
<li class="doctools_section"><a href="#toc">Table Of Contents</a></li>
<li class="doctools_section"><a href="#synopsis">Synopsis</a></li>
<li class="doctools_section"><a href="#section1">Description</a></li>
<li class="doctools_section"><a href="#section2">COMMANDS</a></li>
<li class="doctools_section"><a href="#section3">EXAMPLES</a></li>
<li class="doctools_section"><a href="#see-also">See Also</a></li>
<li class="doctools_section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="synopsis" class="doctools_section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="doctools_synopsis">
<ul class="doctools_syntax">
<li><a href="#1"><b class="cmd">ns_httpopen</b> <i class="arg">method</i> <i class="arg">url</i> <span class="opt">?<i class="arg">rqset</i>?</span> <span class="opt">?<i class="arg">timeout</i>?</span> <span class="opt">?<i class="arg">pdata</i>?</span></a></li>
</ul>
</div>
</div>
<div id="section1" class="doctools_section"><h2><a name="section1">Description</a></h2>
<p>This command is deprecated; use <b class="cmd"><a href="ns_http.html">ns_http</a></b> instead.</p>
<p>This command opens an HTTP connection to a web page used to fetch its contents
via the method, which may be POST, GET, or another valid HTTP method.  If the
act of opening the connections fails, it may throw an error.
The url may be either absolute () or local (/page). If it is local, the host and
port number of the server are added.
The parameter rqset is the handle for an ns_set containing headers to send with
the request. The timeout is the number of seconds to wait for the connection to
open.  Pdata is the  extra data to send with the request (i.e. post data). If
pdata is specified, the caller is responsible for supplying the Content-length
and Content-type headers in rqset The call returns a list with these three elements:
a file descriptor for reading, a file descriptor for writing, and a set ID for a set
describing the connection. 
Note: This command is currently implemented in Tcl, in the source file tcl/http.tcl</p>
</div>
<div id="section2" class="doctools_section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="doctools_definitions">
<dt><a name="1"><b class="cmd">ns_httpopen</b> <i class="arg">method</i> <i class="arg">url</i> <span class="opt">?<i class="arg">rqset</i>?</span> <span class="opt">?<i class="arg">timeout</i>?</span> <span class="opt">?<i class="arg">pdata</i>?</span></a></dt>
<dd></dd>
</dl>
</div>
<div id="section3" class="doctools_section"><h2><a name="section3">EXAMPLES</a></h2>
<pre class="doctools_example">
    # A proc to post some data to a URL and return the result
    proc postit {url data} {
        set rqset [ns_set new rqset]
        ns_set put $rqset &quot;Accept&quot; &quot;*/*&quot;
        ns_set put $rqset &quot;User-Agent&quot; &quot;[ns_info name]-Tcl/[ns_info version]&quot;
        # ns_set put $rqset &quot;Content-type&quot; &quot;text/xml&quot;
        ns_set put $rqset &quot;Content-type&quot; &quot;application/x-www-form-urlencoded&quot;
        ns_set put $rqset &quot;Content-length&quot; [string length $data]
        set timeout 15
        set connInfo [ns_httpopen POST $url $rqset $timeout $data]
        foreach {rfd wfd headers} $connInfo break
        close $wfd
        set length [ns_set iget $headers content-length]
        if {[string match &quot;&quot; $length]} {
            set length -1
        }
        set page &quot;&quot;
        set err [catch {
            # Read the content.
            while {1} {
                set buf [_ns_http_read $timeout $rfd $length]
                append page $buf
                if {[string match &quot;&quot; $buf]} {
                    break
                }
                if {$length &gt; 0} {
                    incr length -[string length $buf]
                    if {$length &gt;= 0} {
                        break
                    }
                }
            }
        } errMsg]
        ns_set free $headers
        close $rfd
        if {$err} {
            return -code error -errorinfo $::errorInfo $errMsg
        }
        return $page
    }
</pre>
</div>
<div id="see-also" class="doctools_section"><h2><a name="see-also">See Also</a></h2>
<p><a href="ns_http.html">ns_http</a>, <a href="ns_httpget.html">ns_httpget</a>, <a href="ns_httppost.html">ns_httppost</a>, <a href="ns_httptime.html">ns_httptime</a></p>
</div>
<div id="keywords" class="doctools_section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#key36">http-client</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
