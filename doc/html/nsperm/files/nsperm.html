<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<title>nsperm - </title>
<link rel="stylesheet" href="../man.css" type="text/css">
</head>
<!-- Generated from file 'nsperm.man' by tcllib/doctools with format 'html'
   -->
<!-- nsperm.n
   -->
<body><div id="man-header">
  <a href="https://wiki.tcl-lang.org/page/NaviServer"><span class="logo">&nbsp;</span><strong>NaviServer</strong></a>
  - programmable web server
</div>
 <hr> [
   <a href="../../toc.html">Main Table Of Contents</a>
&#124; <a href="../toc.html">Table Of Contents</a>
&#124; <a href="../../index.html">Keyword Index</a>
 ] <hr>
<div class="doctools">
<h1 class="doctools_title">nsperm(n) 4.99.23 nsperm &quot;&quot;</h1>
<div id="name" class="doctools_section"><h2><a name="name">Name</a></h2>
<p>nsperm - NaviServer Permissions and Access Control Guide</p>
</div>
<div id="toc" class="doctools_section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="doctools_toc">
<li class="doctools_section"><a href="#toc">Table Of Contents</a></li>
<li class="doctools_section"><a href="#section1">Description</a></li>
<li class="doctools_section"><a href="#section2">Access Control</a></li>
<li class="doctools_section"><a href="#section3">Users and Groups</a></li>
<li class="doctools_section"><a href="#section4">Defining Users</a></li>
<li class="doctools_section"><a href="#section5">Defining Groups</a></li>
<li class="doctools_section"><a href="#section6">Permissions</a></li>
<li class="doctools_section"><a href="#section7">Permissions Inheritance</a></li>
<li class="doctools_section"><a href="#section8">Setting Permissions for Users and Groups</a></li>
<li class="doctools_section"><a href="#section9">Allowing Hosts</a></li>
<li class="doctools_section"><a href="#section10">Denying Hosts</a></li>
<li class="doctools_section"><a href="#section11">.htaccess Mode</a></li>
<li class="doctools_section"><a href="#see-also">See Also</a></li>
<li class="doctools_section"><a href="#keywords">Keywords</a></li>
</ul>
</div>
<div id="section1" class="doctools_section"><h2><a name="section1">Description</a></h2>
</div>
<div id="section2" class="doctools_section"><h2><a name="section2">Access Control</a></h2>
<p>NaviServer allows you to define users and groups of users, and assign
permission records to individual pages or entire page hierarchies.
NaviServer users are distinct from operating system users. A permission
record lets you allow or disallow lists of users, lists of groups, and
lists of hosts for a method and URL combination.</p>
<p>NaviServer requires one special user, nsadmin. This user is always
allowed access to any URL on a NaviServer. The nsadmin user is similar
to the Unix root user.</p>
<p>NaviServer is configured by default with the nsadmin user, a system
group, a public group, and a users group.</p>
<p>You can change the permissions given to the system, public, and users
groups and assign users to them by following the procedures described
in this chapter.</p>
</div>
<div id="section3" class="doctools_section"><h2><a name="section3">Users and Groups</a></h2>
<p>NaviServer users are identified by short usernames. These usernames
can be any name you choose; they are completely independent of the
Unix login accounts. New users can be assigned subdirectories of the
NaviServer pages directory where they can store content.</p>
</div>
<div id="section4" class="doctools_section"><h2><a name="section4">Defining Users</a></h2>
<p>To define NaviServer users, you need to create entries for them in the
passwd file, which resides in the /modules/nsperm directory. The
default passwd file contains:</p>
<pre class="doctools_example">
 &quot;&quot;::::::
 nsadmin:CUdnvgBYocLSI:::::
 nobody::::::
</pre>
<p>The format is the same as the format for the /etc/passwd file.
NaviServer ignores all but the first two fields, which are the username and the encrypted password. The password itself is encrypted the
same way as Unix passwords.</p>
<p>The &quot;&quot; user is the unauthenticated user and is treated the same as any
other user.</p>
</div>
<div id="section5" class="doctools_section"><h2><a name="section5">Defining Groups</a></h2>
<p>To define NaviServer groups, you need to create entries for them in the
group file, which resides in the /modules/nsperm directory. The
default group file contains:</p>
<pre class="doctools_example">
 system:::nsadmin
 users:::nsadmin,nobody
 all:::nsadmin,nobody,&quot;&quot;
 public:::&quot;&quot;
</pre>
<p>The format is the same as the format for the /etc/group file.
NaviServer ignores all but the first and last fields, which are the
name of the group and a comma-separated list of users in the group.</p>
<p>The default group file, shown above, creates groups called system,
users, all, and public, with the listed users in each.</p>
</div>
<div id="section6" class="doctools_section"><h2><a name="section6">Permissions</a></h2>
<p>Permission records indicate the allowed access for a particular URL
and method (GET, and PUT). GET access to a URL allows the user to
display the page, or submit information in a form. PUT access allows
the user to write to the page or delete the page.</p>
<p>Once you have defined authorized NaviServer users and groups, you can
maintain NaviServer permission records. Normally, only nsadmin and
users in the system group can set permission records directly.</p>
</div>
<div id="section7" class="doctools_section"><h2><a name="section7">Permissions Inheritance</a></h2>
<p>To simplify the permission structure and reduce the number of
permission records you need to maintain, you can specify that a
permission record is inherited by more specific URLs. For example, a
permission record for /a/b would be inherited by /a/b/c.htm if there
is no specific permission record for /a/b/c.htm.</p>
</div>
<div id="section8" class="doctools_section"><h2><a name="section8">Setting Permissions for Users and Groups</a></h2>
<p>To define NaviServer permissions for users and groups, you need to
create permission entries for them in the perms file, which resides in
the /modules/nsperm directory. The default perms file does not contain
any permission entries, but it contains the following comments, which
explain how to add entries to the file:</p>
<pre class="doctools_example">
 # This is the NaviServer perms file which defines which users
 # and groups may or may not visit certain URLs.
 #
 # The format is:
 # ACTION  INHERITANCE  METHOD  URL  ENTITY
 #
 # ACTION can be: denygroup, allowgroup, denyuser, or allowuser
 # INHERITANCE can be: inherit or noinherit
 # METHOD can be: PUT, GET, POST, or any other supported method.
 # URL is the path relative to pageroot, e.g., /index.html or
 # /images
 # ENTITY is either the name of a user or group, as specified in
 # the passwd and group files.
 #
 # Example:
 # denyuser  inherit GET /NS &quot;&quot;
 # allowuser inherit GET /NS nsadmin
</pre>
</div>
<div id="section9" class="doctools_section"><h2><a name="section9">Allowing Hosts</a></h2>
<p>You can specifically allow hosts to log in as certain users. The
hosts.allow file, which resides in the /modules/nsperm directory,
allows you to specify which hosts may log in as certain users. The
default hosts.allow file contains:</p>
<pre class="doctools_example">
 #
 # This is the NaviServer hosts.allow file. It allows you to specify
 # which hosts may log in as certain users. If you have an entry
 # in this file for a given user, you may not have an entry in
 # hosts.deny for that same user.
 #
 #
 nsadmin: 10.0.0.0/8, ::1/64, .internal.mycompany.com, home.me.com
</pre>
<p>The format for entries in the file is:</p>
<pre class="doctools_example">
 username: host, host, host ...
</pre>
<p>where username is a user defined in the passwd file and host can be
specified in either of these forms:</p>
<ul class="doctools_itemized">
<li><p>ipaddress/netmask</p>
<p>For example, a host specified as 10.0.0.0/8 (which is the
 same as 10.0.0.0/255.0.0.0) matches any IP address
 that begins with 10.</p></li>
<li><p>a fully-qualified hostname</p>
<p>For example, foo.bar.com.</p></li>
<li><p>part of a hostname</p>
<p>For example, .bar.com, which would match anything ending in
 .bar.com.</p></li>
</ul>
<p>Any user in this file must be coming from one of the listed addresses
to gain access.</p>
</div>
<div id="section10" class="doctools_section"><h2><a name="section10">Denying Hosts</a></h2>
<p>You can specifically deny hosts from logging in as certain users. The
hosts.deny file, which resides in the /modules/nsperm directory,
allows you to specify which hosts cannot log in as certain users. The
default hosts.deny file contains:</p>
<pre class="doctools_example">
 #
 # This is the NaviServer hosts.deny file. It allows you to specify
 # which hosts may not log in as certain users. If you have an
 # entry in this file for a given user, you may not have an entry
 # in hosts.allow for that same user.
 #
 # Example:
 #
 # nsadmin: hacker.badguy.com, .aol.com, 10.2.114.0/24
 #
</pre>
<p>The format for entries in the file is:</p>
<pre class="doctools_example">
 username: host, host, host ...
</pre>
<p>where username is a user defined in the passwd file and host can be
specified in either of these forms:</p>
<ul class="doctools_itemized">
<li><p>ipaddress/netmask</p>
<p>For example, a host specified as 10.0.0.0/8 matches any
 IP address that begins with 10.</p></li>
<li><p>a fully-qualified hostname</p>
<p>For example, foo.bar.com.</p></li>
<li><p>part of a hostname</p>
<p>For example, .bar.com, which would match anything ending in
 .bar.com.</p></li>
</ul>
</div>
<div id="section11" class="doctools_section"><h2><a name="section11">.htaccess Mode</a></h2>
<p>This mode is similar to Apache but more simpler and limited in functionality. It supports only
allowing and denying access to a particular directory.</p>
<p>To enable this</p>
<pre class="doctools_example">
 ns_section ns/server/$server/module/nsperm {
   ns_param   htaccess   true
   ns_param   passwdfile /usr/local/ns/modules/nsperm/passwd
 }
</pre>
<p>passwdfile can point to any file, by default it set to default nsperm module password file.
Now, in the directory where access is wanted, create .htaccess file and add lines like these:</p>
<pre class="doctools_example">
 allow vlad john
 deny steve
</pre>
</div>
<div id="see-also" class="doctools_section"><h2><a name="see-also">See Also</a></h2>
<p><a href="ns_perm.html">ns_perm</a>, ns_permpasswd, ns_permreload</p>
</div>
<div id="keywords" class="doctools_section"><h2><a name="keywords">Keywords</a></h2>
<p><a href="../../index.html#module">module</a>, <a href="../../index.html#nsperm">nsperm</a></p>
</div>
<div id="man-footer">
  
</div>
</div></body></html>
